<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>咨询客服</title>
    <link rel="stylesheet" href="../../css/aui/aui.css">
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../script/emoji/css/jquery.emoji.css">
    <link rel="stylesheet" href="../../script/emoji/css/jquery.mCustomScrollbar.min.css">
    <style>
    body,
    html {
        background: #f5f5f5 !important;
    }

    .aui-list .aui-list-item-label {
        width: 10%;
    }

    .aui-list .aui-list-item-label img {
        width: 1rem;
    }
    /*输入框预输入字体颜色*/

    input::-webkit-input-placeholder {
        /* WebKit browsers */
        color: #999;
    }

    input:-moz-placeholder {
        /* Mozilla Firefox 4 to 18 */
        color: #999;
    }

    input::-moz-placeholder {
        /* Mozilla Firefox 19+ */
        color: #999;
    }

    input:-ms-input-placeholder {
        /* Internet Explorer 10+ */
        color: #999;
    }
    /*默认同意协议*/

    header.aui-bar-nav {
        background-color: #FFFFFF;
        border-bottom: #F5F5F5 solid 1px;
    }

    footer {
        background-color: #FFFFFF;
        border-top: #F5F5F5 solid 1px;
    }

    .aui-title {
        color: #333333;
    }

    .aui-bar-nav .aui-btn .aui-iconfont {
        color: #999999;
    }

    .row{
        padding-left: 0.5rem;
    }
    .row input{
        border-radius: 50px;
        color: #333333;
        border: 1px solid #999999;
        display: inline-block;
    }
    .slide{
        overflow:auto;
        white-space: nowrap;
        margin-left: 2.5rem;
    }
    </style>
    <!--聊天框样式-->
    <style>
        body,
        html {
            background: #ebebeb !important;
        }

        .aui-list .aui-list-item-label {
            width: 10%;
        }

        .aui-list .aui-list-item-label img {
            width: 1rem;
        }
        /*输入框预输入字体颜色*/

        input::-webkit-input-placeholder {
            /* WebKit browsers */
            color: #999;
        }

        input:-moz-placeholder {
            /* Mozilla Firefox 4 to 18 */
            color: #999;
        }

        input::-moz-placeholder {
            /* Mozilla Firefox 19+ */
            color: #999;
        }

        input:-ms-input-placeholder {
            /* Internet Explorer 10+ */
            color: #999;
        }
        /*默认同意协议*/

        .aui-chat .aui-chat-left .aui-chat-content {
            color: #333333;
            background-color: white;
            font-size: 0.7rem;
        }

        .aui-content {
            clear: both;
        }

        .aui-list .aui-list-header {
            background-color: white;
            color: #999999;
            font-size: 0.7rem;
            border-bottom: #f5f5f5 1px solid;
        }

        .aui-list .aui-list-item-inner {
            color: #ebebeb;
            font-size: 0.8rem;
            border-bottom: #f5f5f5 1px solid;
        }

        .aui-chat .aui-chat-left .aui-chat-arrow {
            background-image: linear-gradient(45deg, #ffffff, #ffffff 50%, transparent 50%);
        }

        .aui-chat-content img {
            /*width: 30px;*/
            float: left;
        }
        .aui-chat {
            width: 100%;
            height: 88%;
            padding: 0.5rem;
            overflow-y: scroll;
        }
    </style>
    <!--输入框-->
    <style>
        .emoji_content{
            padding: 0;
        }
        .emoji_content ul li{
            width: 14.55%;
            height: 14.55vw;
            border: 0;
            display: -webkit-box;
            display: -ms-flexbox;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            -webkit-align-items: center;
            align-items: center;
        }
        .emoji_content ul li a{
            display: inline-block;
        }
        .emoji-input-box{
            min-width: 86%;
            max-width: 86%;
            margin: 1vw;
            flex: 1;
        }
        #emoji-input{
            height: 8vw;
            vertical-align: middle;
            background: #fff;
            border:1px solid #ccc;
            border-radius:3px;
            padding: 0 5px;
        }
        #emoji_btn_1{
            display: inline-block;
            vertical-align: middle;
        }
        .dialog-bar{
            position: absolute;
            width: 100%;
            bottom:0;
            border-top:1px solid #ccc;
            background: #ebebeb;
        }
        .dialog-bar .input-group{
            display: flex;
        }
        .add-file-btn{
            margin: 1.5vw;
            width: 7vw;
        }
        .add-other-popup {
            display: none;
            height: 52vw;
            overflow-y: scroll;
            border-top:1px solid #ccc;
        }
        .add-other-popup .other-item{
            margin: 4vw 2.5vw;
            width: 15vw;
            text-align: center;
            float: left;
        }
        #send{
            width: 10vw;
            background: #0bb20c;
            color: #fff;
            text-align: center;
            line-height: 8vw;
            margin: 1vw 0;
            font-size: .6rem;
            display: none;
        }
    </style>
</head>
<body>
    <!-- header -->
    <header class="aui-bar aui-bar-nav" id="header">
        <div class="aui-pull-left aui-btn" onclick="history.back();" tapmode>
            <span class="aui-iconfont aui-icon-left"></span>
        </div>
        <div class="aui-title">客服</div>
    </header>
    <section class="aui-chat" id="message-content">
        <div id="msgList">

        </div>
    </section>
    <div class="dialog-bar">
       <div class="input-group">
           <div class="emoji-input-box">
               <input type="text" id="emoji-input">
               <!--<img id="emoji_btn_1" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZBAMAAAA2x5hQAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAkUExURUxpcfTGAPTGAPTGAPTGAPTGAPTGAPTGAPTGAPTGAPTGAPTGAOfx6yUAAAALdFJOUwAzbVQOoYrzwdwkAoU+0gAAAM1JREFUGNN9kK0PQWEUxl8fM24iCYopwi0muuVuzGyKwATFZpJIU01RUG/RBMnHxfz+Oef9uNM84d1+23nO+zxHKVG2WWupRJkdcAwtpCK0lpbqWE01pB0QayonREMoIp7AawQrWSgGGb4pn6dSeSh68FAVXqHqy3wKrkJiDGDTg3dnp//w+WnwlwIOJauF+C7sXRVfdha4O4oIJfTbtdSxs2uqhs585A0ko8iLTMEcDE1n65A+29pYAlr72nz9dKu7GuNTcsL2fDQzB/wCPVJ69nZGb3gAAAAASUVORK5CYII=">-->
           </div>
           <div class="submit-do add-file-btn">
               <img src="../../image/add_file.png" alt="">
           </div>
           <div class="submit-do" id="send">
               发送
           </div>
       </div>
        <div class="add-other-popup">
            <div class="other-item">
                <div class="pic"><img src="../../res/img/chatBox_album1.png" alt=""></div>
                <p class="name">图片</p>
            </div>
            <div class="other-item">
                <div class="pic"><img src="../../res/img/camera.png" alt=""></div>
                <p class="name">相册</p>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="../../script/api.js"></script>
    <script type="text/javascript" src="../../script/aui/aui-scroll.js"></script>
    <script type="text/javascript" src="../../script/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="../../script/jquery.mCustomScrollbar.min.js"></script>
    <script src="http://cdn.ronghub.com/RongIMLib-2.3.2.min.js"></script>
    <script type="text/javascript" src="../../script/doT.min.js"></script>
    <script type="text/javascript" src="../../script/config.js"></script>
    <script type="text/javascript" src="../../script/sqlite_db.js"></script>
    <script type="text/javascript" src="../../script/common.js"></script>
    <script type="text/javascript" src="../../script/emotion.js"></script>
    <script type="text/javascript" src="../../script/yltcrypt.js"></script>
    <script type="text/javascript" src="../../script/newMsgListen.js"></script>
    <script type="text/javascript" src="../../script/res/layer/mobile/layer.js"></script>
    <script type="text/javascript" src="../../script/emoji/js/jquery.emoji.js"></script>
    <script type="text/javascript" src="../../script/H5_public.js"></script>

    <script type="text/html/x-dot-template" id="data_message">
        {{~it.data :value}} {{?value.sendtype==2}}
        <div class="aui-chat-item aui-chat-right">
            <div class="aui-chat-media">
                <img src="{{=it.avatar}}" />
            </div>
            <div class="aui-chat-inner">
                <div class="aui-chat-content">
                    <div class="aui-chat-arrow"></div>
                    {{=value.info}}
                </div>
                <div class="aui-chat-status"></div>
            </div>
        </div>
        {{??}}
        <div class="aui-chat-item aui-chat-left">
            <div class="aui-chat-media">
                <img src="{{=it.targetAvatar}}" />
            </div>
            <div class="aui-chat-inner">
                <div class="aui-chat-content">
                    <div class="aui-chat-arrow"></div>
                    {{?value.infotype==1}}
                    {{=value.info}}
                    {{??}}
                    <img src="{{=value.info}}" />
                    {{?}}
                </div>
                <div class="aui-chat-status"></div>
            </div>
        </div>
        {{?}} {{~}}
    </script>

    <script type="text/html/x-dot-template" id="data_newmessage">
        {{?it.messageDirection=='1'}}
        <div class="aui-chat-item aui-chat-right">
            <div class="aui-chat-media">
                <img src="{{=it.headImgUrl}}" />
            </div>
            <div class="aui-chat-inner">
                <div class="aui-chat-content">
                    <div class="aui-chat-arrow"></div>
                    {{=it.content.content}}
                </div>
                <div class="aui-chat-status"></div>
            </div>
        </div>
        {{??}}
        <div class="aui-chat-item aui-chat-left">
            <div class="aui-chat-media">
                <img src="{{=it.headImgUrl}}" />
            </div>
            <div class="aui-chat-inner">
                <div class="aui-chat-content">
                    <div class="aui-chat-arrow"></div>
                    {{?it.objectName=='RC:TxtMsg'}}
                    {{=it.content.content}}
                    {{??}}
                    <img src="{{=it.content.imageUrl}}" />
                    {{?}}
                </div>
                <div class="aui-chat-status"></div>
            </div>
        </div>
        {{?}}
    </script>
    <script type="text/javascript">
        var rong, sqlite, user,conversationId, conversationType, targetId,headerH,chatGoodData;
        var  pageSize = 15,pageIndex = 0, targetUser;
            // rong = api.require('rongCloud2');
            // sqlite = api.require('db');
        user = $api.getStorage('user');
        if (user){
            dbopen();
            ronginit();
            var param=H5.pageParam();
            conversationId = param.conversationId;
            conversationType = param.conversationType;
            targetId = param.targetId;
            chatGoodData = param.chatGoodData?JSON.parse(param.chatGoodData):{};
            //获取头部元素
            var header = $api.byId('header');
            //获取头部高度
            headerH = $api.offset(header).h;
            targetUser = getTargetInfo(targetId);
            // openUIChatBox();
            selectMessage(chatGoodData);
            setTimeout(function () {
                goBottom();
            },100);
            //监听接收到消息
            // NewMsgListen.chatWinReceive();
            //消息读取通知
            // NewMsgListen.msgReadPush(targetId);


            //监听发送成功消息
            // api.addEventListener({
            //     name: 'newMessage'
            // }, function(ret, err) {
            //     var message = ret.value.message;
            //     if ("RC:TxtMsg" == message.objectName) {
            //         var interText = doT.template($("#data_newmessage").text());
            //         message.headImgUrl=user.avatar;
            //         $("#msgList").append(interText(message));
            //         goBottom();
            //     }
            // });

            //滚动监听
            var loadMoreMsg = 1;
            // var scroll = new auiScroll({
            //     listen:true, //是否监听滚动高度，开启后将实时返回滚动高度
            //     distance:200 //判断到达底部的距离，isToBottom为true
            // },function(ret){
            //     if(ret.scrollTop>0 && ret.scrollTop<70 && loadMoreMsg){
            //         loadMoreMsg = 0;
            //         document.getElementById('message-content').scrollTop = 15;
            //         selectMessage({});
            //     }
            // });
            $(".aui-chat").on("scroll",function (e) {
                if(this.scrollTop==0 && loadMoreMsg){
                    loadMoreMsg = 0;
                    document.getElementById('message-content').scrollTop = 15;
                    selectMessage({});
                }
            });
            $(".add-file-btn").click(function () {
                $(".add-other-popup").toggle();
            });
            //打开聊天内容窗口
            // api.openFrame({
            //     name: 'consult_frame',
            //     url: './consult_frame.html',
            //     scrollToTop: true,
            //     allowEdit: true,
            //     rect: {
            //         x: 0,
            //         y: headerH,
            //         w: api.winWidth,
            //         h: api.winHeight - headerH
            //     },
            //     pageParam: {
            //         'conversationId': conversationId,
            //         'conversationType': conversationType,
            //         'targetId': targetId,
            //         'headerH':headerH,
            //         'chatGoodData':chatGoodData
            //     },
            //     animation: {
            //         type: "ripple", //动画类型（详见动画类型常量）
            //         subType: "from_right", //动画子类型（详见动画子类型常量）
            //         duration: 300
            //     },
            //     bounces: true
            // });
        }
        var input=$("#emoji-input");
        var text="";
        var sdBtn=$(".submit-do");
        input.on("input",function () {
           text=$.trim(this.value);
           if(text===""){
               sdBtn.eq(0).show();
               sdBtn.eq(1).hide();
           }else{
               sdBtn.eq(0).hide();
               sdBtn.eq(1).show();
           }
        });
        $("#send").click(function () {
            sendTextMessage(text);
        });
        $(".aui-chat").on("touchmove",function (e) {
            e.stopPropagation();
        })
    </script>
</body>

</html>
