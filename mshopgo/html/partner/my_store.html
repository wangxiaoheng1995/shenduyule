<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,initial-scale=1.0,width=device-width"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>我的收入</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/aui/aui.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/base.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/l_style.css"/>
    <style>
      .main-top-bg{
        /*height:5.3rem;*/
        background:url(../../image/partner/background@2x.png);
        background-size:100% 100%;
        padding:0.8rem;
      }
      .store-balance-top{
        width:100%;
        display: flex;
      }
      .account-balance{
        width:50%;
        display:flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .account-balance a{
        display:flex;
        color:#fff;
        font-size:0.8rem;
        align-items: center;
      }
      .account-balance a img{
        width:0.8rem;
        height:0.8rem;
        margin-right:0.2rem;
      }
      .account-balance em{
        margin-left:0.5rem;
        color:#fff;
      }
      .account-detail{
        width:100%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top:0.8rem;
      }
      .account-detail span{
        border:1px solid #fff;
        padding:0.3rem;
        box-sizing: border-box;
        color:#fff;
        font-size:0.6rem;
        border-radius:8px;
      }
      .store-detail li{
        padding:0.8rem;
      }
      .partner-store-title{
        display: flex;
        padding-bottom:0.4rem;
        width:30%;
        border-bottom: 2px solid #FE5095;
      }
      .partner-store-title img{
        margin-right:0.5rem;
        width:0.85rem;
        height:0.85rem;
      }
      .partner-store-order{
        display:flex;
        justify-content: space-around;
        align-items: center;
        margin:0.8rem 0;
      }
      .store-order-number1{
        background:url(../../image/partner/background@2x.png);
        background-size:100% 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .store-order-number1{
        background:url(../../image/partner/background@2x.png);
        background-size:100% 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .store-order-number{
        display: flex;
        justify-content: center;
        flex-direction: column;
        align-items: flex;
      }
      .store-order-number{
        display:flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .order-number-img1,.order-number-img2,.order-number-img3{
        background:url(../../image/partner/icon2@2x.png);
        background-size:100% 100%;
      }
      .store-order-number a{
        display:flex;
        justify-content: center;
        align-items: center;
        width:2.5rem;
        height:2.5rem;
        color:#fff;
      }
      .store-order-number span{
        margin-top:0.5rem;
        color:#333;
        font-size:0.7rem;
      }
      #main{
        background: #fff;
      }
      [v-cloak] {
        display: none;
      }
    </style>
</head>
<body>
<div id="wrap" v-cloak>
    <header class="aui-bar aui-bar-nav tit-bar-black back-write header-nav" style="background:#fe5095!important;color:#fff">
        <a class="aui-pull-left aui-btn" onclick="window.history.back()">
            <span class="aui-iconfont aui-icon-left aui-font-size-20"></span>
        </a>
        <div class="aui-title">我的店铺</div>
    </header>
    <div class="header-nav-top" id="content">
        <div class="main-top-bg">
          <div class="store-balance-top">
            <div class="account-balance left">
              <a><img src="../../image/partner/my_store_money.png" alt=""><span>店铺余额</span></a>
              <em>{{shopList.balance}}</em>
            </div>
            <div class="account-balance right">
              <a><img src="../../image/partner/my_store_money.png" alt=""><span>冻结余额</span></a>
              <em>{{shopList.frozenassets}}</em>
            </div>
           </div>
            <div class="account-detail" onclick="window.location.href='./my_store_detail.html'">
              <span>查看详情</span>
            </div>
        </div>
        <ul class="aui-list aui-media-list msg-list back-none store-detail" id="income-detail">
             <li v-for="(item,index) in shopList.data">
               <div class="partner-store-title">
                     <img src="../../image/partner/icon5@2x.png" alt="">
                     <span>{{item.shopName}}</span>
               </div>
               <div class="partner-store-order">
                 <div class="store-order-number">
                   <a class="order-number-img1">{{item.todoamount}}</a>
                   <span>待处理订单</span>
                 </div>
                 <div class="store-order-number">
                   <a class="order-number-img2">{{item.visitamount}}</a>
                   <span>今日访问量</span>
                 </div>
                 <div class="store-order-number">
                   <a class="order-number-img3">{{item.orderamount}}</a>
                   <span>订单量</span>
                 </div>
               </div>
               <div class="partner-store-chart">
                 <div :id="'main'+index" style="width:100%;height:20rem;padding-left:0.5rem" v-if="index==0"></div>
               </div>
               {{createChart({el:'main'+index,v:item.visit_amountLine,o:item.order_amountLine})}}
             </li>
        </ul>
    </div>
</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/base.js"></script>
<script src="../../script/common.js"></script>
<script src="../../script/config.js"></script>
<script src="../../script/aui/aui-toast.js"></script>
<script type="text/javascript" src="../../script/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="../../script/vue.js"></script>
<script type="text/javascript" src="../../script/echarts.min.js"></script>
</script>
<script type="text/javascript">
    var user
    user = $api.getStorage('user');
    // alert(user.openId)
    new Vue({
        el: "#wrap",
        data: {
            shopList: {}
        },
        methods: {
            createChart(obj) {
                var self = this;
                setTimeout(function() {
                    var myChart = echarts.init(document.getElementById(obj.el));
                    var option = {
                        xAxis: {
                            type: 'category',
                            data: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '24', '26', '27', '28', '29', '30', '31']
                        },
                        yAxis: {
                            type: 'value',
                            axisLine: {
                                lineStyle: {
                                    color: '#000',
                                    width: 1,
                                }
                            },
                            splitNumber: 10
                        },
                        legend: {
                            orient: 'horizontal',
                            left: 'left',
                            type: 'plain',
                            data: ['访问量', '订单量'],
                            itemGap: 20,
                            icon: 'stack'
                        },
                        color: ['#6599FE', '#00FE67'],
                        series: [{
                            name: '访问量',
                            data: obj.v,
                            type: 'line'
                        }, {
                            name: '订单量',
                            data: obj.o,
                            type: 'line'
                        }, ]
                    };
                    myChart.setOption(option);
                }, 200)
            },
            loadStore() {
                var self = this
                $.ajax({
                    url: PHP_SERVE_URL + '/shop/myshopInfo',
                    type: 'post',
                    data: {
                            openId: user.openId
                    },
                    success:function(ret, err) {
                        if(ret.code==0){
                          for (var item in ret.data) {
                              ret.data[item].visit_amountLine = [];
                              ret.data[item].order_amountLine = [];
                              for (var point in ret.data[item].brokenLine) {
                                  ret.data[item].visit_amountLine.push(ret.data[item].brokenLine[point].visit_amount);
                                  ret.data[item].order_amountLine.push(ret.data[item].brokenLine[point].order_amount);
                              }
                          }
                          self.shopList = ret;
                        }
                    }
                })
            }
        },
        mounted: function() {
            this.loadStore()
        },
    })

</script>

</html>
